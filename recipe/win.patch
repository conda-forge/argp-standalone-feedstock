From f266989587b04b247c9d20700657a00ab5f42b93 Mon Sep 17 00:00:00 2001
From: gorazdko <gorazdko@gmail.com>
Date: Fri, 11 Sep 2020 22:57:36 +0200
Subject: [PATCH] build on windows

---
 argp-standalone/argp-eexst.c |  4 ++++
 argp-standalone/argp-test.c  |  6 +++---
 argp-standalone/argp.h       | 17 ++++++++++++++++-
 3 files changed, 23 insertions(+), 4 deletions(-)

diff --git a/argp-standalone/argp-eexst.c b/argp-standalone/argp-eexst.c
index 9040058..d845a5d 100644
--- a/argp-standalone/argp-eexst.c
+++ b/argp-standalone/argp-eexst.c
@@ -22,7 +22,11 @@
 #include <config.h>
 #endif
 
+#ifdef _WIN32
+#define EX_USAGE 64
+#else
 #include <sysexits.h>
+#endif
 
 #include "argp.h"
 
diff --git a/argp-standalone/argp-test.c b/argp-standalone/argp-test.c
index d19b548..e5ed2a1 100644
--- a/argp-standalone/argp-test.c
+++ b/argp-standalone/argp-test.c
@@ -46,7 +46,7 @@ asprintf (char **result, const char *format, ...)
   {
     va_list args;
     int written;
-    
+
     p = realloc(p, size + 1);
     if (!p)
     {
@@ -55,7 +55,7 @@ asprintf (char **result, const char *format, ...)
     }
 
     p[size] = '\0';
-    
+
     va_start(args, format);
     written = vsnprintf(p, size, format, args);
     va_end(args);
@@ -247,7 +247,7 @@ main (int argc, char **argv)
 {
   struct params params;
   params.foonly = 0;
-  params.foonly_default = random ();
+  params.foonly_default = rand();
   argp_parse (&argp, argc, argv, 0, 0, &params);
   printf ("After parsing: foonly = %x\n", params.foonly);
   return 0;
diff --git a/argp-standalone/argp.h b/argp-standalone/argp.h
index 56f1c3d..528a98f 100644
--- a/argp-standalone/argp.h
+++ b/argp-standalone/argp.h
@@ -397,15 +397,30 @@ struct argp_state
    routine returned a non-zero value, it is returned; otherwise 0 is
    returned.  This function may also call exit unless the ARGP_NO_HELP flag
    is set.  INPUT is a pointer to a value to be passed in to the parser.  */
+
+#ifdef _WIN32
+   extern error_t
+   argp_parse (const struct argp *argp, int argc, char **argv, unsigned flags,
+
+              int *end_index, void *input)__THROW;
+
+   extern error_t
+   __argp_parse (const struct argp *argp, int argc, char **argv, unsigned flags,
+
+              int *end_index, void *input)__THROW;
+#else
+
 extern error_t argp_parse (__const struct argp *__restrict __argp,
 			   int __argc, char **__restrict __argv,
 			   unsigned __flags, int *__restrict __arg_index,
 			   void *__restrict __input) __THROW;
+
 extern error_t __argp_parse (__const struct argp *__restrict __argp,
 			     int __argc, char **__restrict __argv,
 			     unsigned __flags, int *__restrict __arg_index,
 			     void *__restrict __input) __THROW;
-
+#endif
+
 /* Global variables.  */
 
 /* If defined or set by the user program to a non-zero value, then a default
 Login with GitHub
